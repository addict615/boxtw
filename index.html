<html lang="zh-TW">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://mottie.github.io/tablesorter/js/jquery.tablesorter.js"></script>
  <script src="https://codepen.io/addict615/pen/ZEYzaxX"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.1/css/theme.default.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <title>票房111</title>
  </head>

 <body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container"> 
      <a class="navbar-brand" href="index.html">票房111</a>
    </div>
  </nav>   


<div class="col-lg-5" style="margin:10px">
  <p class="lead" id="loading">Connecting...</p>
  <Form id="wboxList" style="display:none">
    <select id="wboxSelect" class="col-md-6 form-control"></select>
  </Form>
</div>
<div id="weekly_table" class="col-lg-10" style="margin:15px"></div>
<div id="wboxDetails" class="col-lg-10" style="margin:15px"></div>

 <script>
var employeeData;
$(document).ready(function() {
  $.getJSON(
    "https://sheets.googleapis.com/v4/spreadsheets/1N2upLY61o3hxaW4rAgqBjx7U1LntsmLutXE9LTAwCy8/values/top20weekly!A1:K101?key=AIzaSyBn2U8krqzA8EZrKk2Ca6HXA3JHj0Y76F0",
    function(data) {
      employeeData = data;
      console.log(data);

      var table = $(
        '<table ID="WeeklyTable" class="table table-striped tablesorter top20"></table>'
      );
      table.append(
        $(
          '<thead><tr><th>本周排名</th><th>上週排名</th><th>中文片名</th><th>上映週數</th><th>觀影人次</th><th>跌幅</th><th class="sorter-namedNumbers">本周票房</th><th class="sorter-namedNumbers">累積人次</th><th class="sorter-namedNumbers">累積票房</th><th>國別地區</th></thead>'
        )
      );
      for (i = 1; i < 21; i++) {
        var employee = employeeData.values[i];
        table.append(
          $(
            "<tr><td>" +
              employee[1] +
              "</td><td>" +
              employee[2] +
              "</td><td>" +
              employee[3] +
              "</td><td>" +
              employee[4] +
              "</td><td>" +
              employee[5] +
              "</td><td>" +
              employee[6] +
              "</td><td>" +
              employee[7] +
              "</td><td>" +
              employee[8] +
              "</td><td>" +
              employee[9] +
              "</td><td>" +
              employee[10] +
              "</td>"
          )
        );
      }
      $("#weekly_table").html("");
      $("#weekly_table").append(table);

      $("#WeeklyTable").tablesorter({ widgets: ["zebra", "cssStickyHeaders"] });

      for (i = 1; i < data.values.length; i += 20) {
        //建立選擇器內容 i可隨表格調整1或0
        var employeeName = data.values[i][0];
        $("#wboxSelect").append(
          $("<option>", {
            value: employeeName,
            text: employeeName
          })
        );
      }
      $("#wboxList").show();
      $("#loading").hide();
    }
  );
});

//按鈕送出 取值
//$('#employeeList').submit(function(e){
$("#wboxSelect").change(function() {
  //  e.preventDefault();
  displayWboxoffice($("#wboxSelect").val());
});

//顯示DB資料詳細
function displayWboxoffice(name) {
  var table = $(
    '<table ID="Querytable" class="table table-striped tablesorter top20"></table>'
  );

  table.append(
    $(
      '<thead><tr><th>本周排名</th><th>上週排名</th><th>中文片名</th><th>上映週數</th><th>觀影人次</th><th>跌幅</th><th class="sorter-namedNumbers">本周票房</th><th class="sorter-namedNumbers">累積人次</th><th class="sorter-namedNumbers">累積票房</th><th>國別地區</th></thead>'
    )
  );

  for (i = 1; i <= 100; i++) {
    console.log(i);
    var employee = employeeData.values[i];
    if (employee[0] == name) {
      table.append(
        $(
          "<tr><td>" +
            employee[1] +
            "</td><td>" +
            employee[2] +
            "</td><td>" +
            employee[3] +
            "</td><td>" +
            employee[4] +
            "</td><td>" +
            employee[5] +
            "</td><td>" +
            employee[6] +
            "</td><td>" +
            employee[7] +
            "</td><td>" +
            employee[8] +
            "</td><td>" +
            employee[9] +
            "</td><td>" +
            employee[10] +
            "</td>"
        )
      );
    }
  }

  $("#weekly_table").html("");
  $("#wboxDetails").html("");
  $("#wboxDetails").append(table);
  $("#Querytable").tablesorter({ widgets: ["zebra", "cssStickyHeaders"] });
}


 </script>
 
 </body>
</html>
